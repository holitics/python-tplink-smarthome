from tplink_smarthome.protocol import encrypt, decrypt


def test_encrypt():
    result = encrypt("{'system': {'get_sysinfo': {}}}")
    expected_result = [0x0, 0x0, 0x0, 0x1f, 0xd0, 0xf7, 0x84, 0xfd,
                       0x8e, 0xfa, 0x9f, 0xf2, 0xd5, 0xef, 0xcf, 0xb4,
                       0x93, 0xf4, 0x91, 0xe5, 0xba, 0xc9, 0xb0, 0xc3,
                       0xaa, 0xc4, 0xa2, 0xcd, 0xea, 0xd0, 0xf0, 0x8b,
                       0xf6, 0x8b, 0xf6]

    assert result == bytes(expected_result)


def test_decrypt():
    message = [0xd0, 0xf2, 0x81, 0xf8, 0x8b, 0xff, 0x9a, 0xf7, 0xd5, 0xef,
               0x94, 0xb6, 0xc5, 0xa0, 0xd4, 0x8b, 0xf9, 0x9c, 0xf0, 0x91,
               0xe8, 0xb7, 0xc4, 0xb0, 0xd1, 0xa5, 0xc0, 0xe2, 0xd8, 0xa3,
               0x81, 0xe4, 0x96, 0xe4, 0xbb, 0xd8, 0xb7, 0xd3, 0xb6, 0x94,
               0xae, 0x9e, 0xe3, 0x9e, 0xe3]
    expected_result = '{"system":{"set_relay_state":{"err_code":0}}}'
    result = decrypt(bytes(message))

    assert result == expected_result
